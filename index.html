<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>DXF → GLB</title>
<meta name="color-scheme" content="light dark">

<!-- Visor GLB (requiere internet) -->
<script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
<script type="importmap">
    {
      "imports": {
        "three": "./libs/three/three.module.min.js"
      }
    }
    </script>


<link rel="stylesheet" href="assets/css/app.css">
</head>
<body>
  <header><button id="toggleAside" class="btn btn-ghost" aria-label="Mostrar panel" aria-expanded="false" aria-controls="sidebar">☰ Panel</button><img src="img/logo26px.png" alt="logo" class="app-logo" /> <h1>VISOR DE TOPOGRAFIA</h1></header>
  <div class="wrap">
    <aside id="sidebar">
      <h2>1) Archivo</h2>
      <div class="row">
        <div class="row" id="preTypeGroup" style="gap:16px; margin:8px 0;">
      <strong style="font-size:13px;">Clasificar antes de importar:</strong>
      <label><input type="radio" name="preType" value="tajos"> Tajos</label>
      <label><input type="radio" name="preType" value="avances"> Avances</label>
      <label><input type="radio" name="preType" value="proyecto"> Proyecto</label>
    </div>
<input id="file" type="file" accept=".dxf" disabled></div>
      <div class="row">
        <label class="muted">Unidades:
          <select id="units">
            <option value="auto" selected>auto (INSUNITS o mm→m)</option>
            <option value="mm">mm</option>
            <option value="cm">cm</option>
            <option value="m">m</option>
            <option value="in">in</option>
            <option value="ft">ft</option>
          </select>
        </label>
        <label class="muted"><input id="inclLines" type="checkbox" checked> Incluir líneas (si no hay 3DFACE)</label>
      </div>

      <h2>2) Extrusión</h2>
      <div class="row">
        <label class="muted"><input id="extrudePolys" type="checkbox" checked> Extruir polilíneas cerradas</label>
        <label class="muted">Espesor Z (m): <input id="depth" type="number" value="0.1" step="0.01" min="0.001" style="width:100px"></label>
      </div>
      <div class="row">
        <label class="muted"><input id="extrudeLines" type="checkbox"> Dar volumen a LINE</label>
        <label class="muted">Ancho (m): <input id="lineW" type="number" value="0.02" step="0.005" min="0.001" style="width:100px"></label>
      </div>
      <div class="muted note">Las polilíneas deben estar cerradas para un sólido correcto. Las LINE se vuelven “barras” con ancho y espesor.</div>

      <h2>3) Generar</h2>
      <div class="row">
        <button id="convert" class="btn" disabled>Generar GLB</button>
        <button id="download" class="btn" disabled>Descargar GLB</button>
      </div>
      <div class="row">
        <span class="chip" id="unitsChip">Unidad: —</span>
        <span class="chip" id="facesChip">Caras: —</span>
        <span class="chip" id="linesChip">Líneas: —</span>
      </div>

      <h2>Registro</h2>
      <div id="log"></div>
      <p class="muted">La conversión funciona sin Internet. El <strong>visor</strong> requiere conexión para cargar el componente web.</p>
    </aside>
    <main>
      <model-viewer id="viewer" camera-controls auto-rotate environment-image="neutral" shadow-intensity="1">
<div id="advancedViewer">
  <canvas id="advCanvas"></canvas>
</div>

<div id="viewerOverlay">
  <label style="color:#e6e9ef; font-size:12px;">
    Vista:
    <select id="viewPreset" style="margin-left:6px; padding:4px 6px; border-radius:6px; border:1px solid #2a2f3a; background:#0c1118; color:#e6e9ef;">
      <option value="iso">Isométrica</option>
      <option value="top">Superior</option>
      <option value="front">Frontal</option>
      <option value="right">Derecha</option>
    </select>
  </label>
  <label style="color:#e6e9ef; font-size:12px; margin-left:8px;">
    Sección:
    <input type="checkbox" id="sectionMode" />
  </label>
  <label style="color:#e6e9ef; font-size:12px; display:none;" id="sectionControls">
    Eje:
    <select id="sectionAxis" style="margin:0 6px; padding:4px 6px; border-radius:6px; border:1px solid #2a2f3a; background:#0c1118; color:#e6e9ef;">
      <option value="x">X</option>
      <option value="y">Y</option>
      <option value="z" selected>Z</option>
    </select>
    Corte: <input type="range" id="sectionPos" min="-10" max="10" value="0" step="0.1" style="vertical-align:middle; width:140px;">
    <button id="exitSection" class="btn" style="margin-left:6px;">Volver visor</button>
  </label>
</div>
</model-viewer>
    </main>
  </div>


<script type="module" src="assets/js/app.js"></script>

<div id="asideBackdrop" class="aside-backdrop" hidden></div>
</body>
</html>
